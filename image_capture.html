<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Two Photos and Convert to Base64</title>
    <style>
        video, canvas {
            display: block;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <h2>Press 's' to capture two photos with a 1.5s delay, convert them to Base64, or 'q' to stop the video.</h2>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas1" width="640" height="480" style="border:1px solid black; display:none;"></canvas>
    <canvas id="canvas2" width="640" height="480" style="border:1px solid black; display:none;"></canvas>

    <!-- Download links for the images -->
    <a id="download1" download="image1.jpg" style="display:none;">Download Image 1</a>
    <a id="download2" download="image2.jpg" style="display:none;">Download Image 2</a>

    <div id="output"></div>

    <script>
        // Access the video element and canvas elements
        const video = document.getElementById('video');
        const canvas1 = document.getElementById('canvas1');
        const canvas2 = document.getElementById('canvas2');
        const ctx1 = canvas1.getContext('2d');
        const ctx2 = canvas2.getContext('2d');

        const downloadLink1 = document.getElementById('download1');
        const downloadLink2 = document.getElementById('download2');
        const output = document.getElementById('output');

        // Variables to store the Base64 strings for the images
        let base64Image1 = "";
        let base64Image2 = "";

        // Request access to the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                video.srcObject = stream;
            })
            .catch((err) => {
                console.error("Error accessing the webcam:", err);
            });

        // Function to capture, save, and convert images to Base64
        function captureAndSavePhotos() {
            // Capture the first photo on canvas1
            ctx1.drawImage(video, 0, 0, canvas1.width, canvas1.height);
            console.log("First photo captured.");

            // Convert the canvas to a Base64 string
            base64Image1 = canvas1.toDataURL('image/jpeg');
            downloadLink1.href = base64Image1;  // Set the download link
            downloadLink1.click();  // Simulate a click to download image1

            console.log("First image Base64:", base64Image1);  // Log the Base64 string
            output.innerHTML += `<p>First Image Base64:</p><textarea rows="4" cols="80">${base64Image1}</textarea>`;

            // Wait 1.5 seconds and then capture the second photo on canvas2
            setTimeout(() => {
                ctx2.drawImage(video, 0, 0, canvas2.width, canvas2.height);
                console.log("Second photo captured.");

                // Convert the canvas to a Base64 string
                base64Image2 = canvas2.toDataURL('image/jpeg');
                downloadLink2.href = base64Image2;  // Set the download link
                downloadLink2.click();  // Simulate a click to download image2

                console.log("Second image Base64:", base64Image2);  // Log the Base64 string
                output.innerHTML += `<p>Second Image Base64:</p><textarea rows="4" cols="80">${base64Image2}</textarea>`;
            }, 1500);  // Delay of 1.5 seconds
        }

        // Add event listener for keypresses
        document.addEventListener('keydown', (event) => {
            const key = event.key.toLowerCase();  // Normalize the key to lowercase
            if (key === 's') {
                // If 's' is pressed, capture and convert the images
                captureAndSavePhotos();
            } else if (key === 'q') {
                // If 'q' is pressed, stop the webcam
                stopStreamedVideo(video);
                console.log("Video stream stopped.");
            }
        });

        // Function to stop the video stream
        function stopStreamedVideo(videoElement) {
            const stream = videoElement.srcObject;
            const tracks = stream.getTracks();

            tracks.forEach(track => track.stop());  // Stop each track
            videoElement.srcObject = null;  // Clear the video source
        }
    </script>
</body>
</html>